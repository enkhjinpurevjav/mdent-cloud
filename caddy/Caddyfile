{
  email youremail@domain.com
}

mdent.cloud, www.mdent.cloud, app.mdent.cloud {
  encode gzip
  reverse_proxy frontend:3000
}

book.mdent.cloud {
  encode gzip
  reverse_proxy frontend:3000
}

api.mdent.cloud {
  encode gzip

  # Handle CORS preflight OPTIONS requests directly
  @cors_preflight {
    method OPTIONS
    path /api/*
  }

  handle @cors_preflight {
    header {
      Access-Control-Allow-Origin https://mdent.cloud
      Access-Control-Allow-Methods GET,POST,PUT,PATCH,DELETE,OPTIONS
      Access-Control-Allow-Headers Authorization,Content-Type
      Access-Control-Allow-Credentials true
      Access-Control-Max-Age 86400
    }
    respond "" 204
  }

  # Proxy actual requests to the backend
  reverse_proxy mdent-cloud-backend-1:8080

  # Inject CORS headers into all proxied responses (for non-OPTIONS requests)
  header {
    Access-Control-Allow-Origin https://mdent.cloud
    Access-Control-Allow-Methods GET,POST,PUT,PATCH,DELETE,OPTIONS
    Access-Control-Allow-Headers Authorization,Content-Type
    Access-Control-Allow-Credentials true
    Access-Control-Max-Age 86400
  }
}
