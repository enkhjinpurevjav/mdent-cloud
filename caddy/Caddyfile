{
  email youremail@domain.com
}

# Main web + media
mdent.cloud, www.mdent.cloud, app.mdent.cloud {
  encode gzip

  # Explicit matcher for media
  @media path /media/*
  handle @media {
    reverse_proxy backend:8080
  }

  # Everything else -> frontend
  handle {
    reverse_proxy frontend:3000
  }
}

# Booking / doctor UI
book.mdent.cloud {
  encode gzip
  reverse_proxy frontend:3000
}

# Public API
api.mdent.cloud {
  encode gzip

  @cors_preflight {
    method OPTIONS
    path /api/*
  }

  handle @cors_preflight {
    header {
      Access-Control-Allow-Origin https://mdent.cloud
      Access-Control-Allow-Methods GET,POST,PUT,PATCH,DELETE,OPTIONS
      Access-Control-Allow-Headers Authorization,Content-Type
      Access-Control-Allow-Credentials true
      Access-Control-Max-Age 86400
    }
    respond "" 204
  }

  handle {
    reverse_proxy backend:8080

    header {
      Access-Control-Allow-Origin https://mdent.cloud
      Access-Control-Allow-Methods GET,POST,PUT,PATCH,DELETE,OPTIONS
      Access-Control-Allow-Headers Authorization,Content-Type
      Access-Control-Allow-Credentials true
      Access-Control-Max-Age 86400
    }
  }
}
